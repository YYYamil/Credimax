<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PrestamoApp.ResumenCtaPage"
             Title="Resumen de Cuenta"
             BackgroundColor="White">


    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="10">

            <!-- Cliente -->
            <Label Text="Cliente" FontAttributes="Bold" FontSize="18" />
            <HorizontalStackLayout>
                <Label Text="Apellido: " FontAttributes="Italic"/>
                <Label x:Name="lblApellido"/>
            </HorizontalStackLayout>
            <HorizontalStackLayout>
                <Label Text="Nombre: " FontAttributes="Italic"/>
                <Label x:Name="lblNombre"/>
            </HorizontalStackLayout>

            <!-- Datos del crÃ©dito -->
            <Label Text="CrÃ©dito" FontAttributes="Bold" FontSize="18" Margin="0,10,0,0"/>
            <HorizontalStackLayout>
                <Label Text="Tipo de CrÃ©dito: " />
                <Label x:Name="lblTipoCredito" />
            </HorizontalStackLayout>
            <HorizontalStackLayout>
                <Label Text="ObservaciÃ³n: " />
                <Label x:Name="lblObservacion" />
            </HorizontalStackLayout>
            <HorizontalStackLayout>
                <Label Text="Monto CrÃ©dito: " />
                <Label x:Name="lblMontoCredito" />
            </HorizontalStackLayout>
            <HorizontalStackLayout>
                <Label Text="Suma Pagada: " />
                <Label x:Name="lblSumaPago" />
            </HorizontalStackLayout>
            <HorizontalStackLayout>
                <Label Text="Saldo Total: " />
                <Label x:Name="lblSaldoTotal" />
            </HorizontalStackLayout>
            <HorizontalStackLayout>
                <Label Text="Monto Financiado: " />
                <Label x:Name="lblMontoFinanciado" />
            </HorizontalStackLayout>
            <HorizontalStackLayout>
                <Label Text="Fecha Otorgamiento:" FontAttributes="Bold"/>
                <Label x:Name="lblFechaOtorgamiento" />
            </HorizontalStackLayout>

            <Button Text="Eliminar CrÃ©dito" 
        Command="{Binding EliminarCreditoCommand}"
        IsEnabled="{Binding EliminarCreditoCommand.CanExecute}"
        BackgroundColor="Red"
        TextColor="White"
        HorizontalOptions="End"
        Margin="0,0,10,0"/>

            <!-- Detalle de cuotas -->
            <!-- TÃ­tulo -->
            <Label Text="Detalle de Cuotas"
       FontAttributes="Bold"
       FontSize="18"
       Margin="0,20,0,10"/>

            <!-- Cabeceras -->
            <Grid Margin="10,0"
      Padding="10"
      BackgroundColor="#EFEFEF"
      ColumnSpacing="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60" />
                    <!-- NÂ° -->
                    <ColumnDefinition Width="100" />
                    <!-- F. Vto -->
                    <ColumnDefinition Width="100" />
                    <!-- F. Pago -->
                    <ColumnDefinition Width="100" />
                    <!-- Importe -->
                    <ColumnDefinition Width="80" />
                    <!-- Estado -->
                    <!--<ColumnDefinition Width="40" />
                    --><!-- Borrar -->
                </Grid.ColumnDefinitions>

                <Label Text="NÂ°"        FontAttributes="Bold" Grid.Column="0" />
                <Label Text="F. Vto"    FontAttributes="Bold" Grid.Column="1" />
                <Label Text="F. Pago"   FontAttributes="Bold" Grid.Column="2" />
                <Label Text="Importe"   FontAttributes="Bold" Grid.Column="3" />
                <Label Text="Estado"    FontAttributes="Bold" Grid.Column="4" />
                <!--<Label Text="Borrar"    FontAttributes="Bold" Grid.Column="5" HorizontalTextAlignment="End"/>-->
            </Grid>

            <!-- Lista de cuotas (se mantiene tu ItemsSource y botÃ³n) -->
            <ListView x:Name="cuotasListView"
          ItemsSource="{Binding Cuotas}"
          HasUnevenRows="True"
          SeparatorVisibility="None"
          BackgroundColor="Transparent"
          Margin="10,0,10,20">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <!-- Recuadro por fila -->
                            <Frame Padding="0" Margin="0,6" CornerRadius="8"
                       HasShadow="False" BorderColor="#DDDDDD"
                       BackgroundColor="White">
                                <StackLayout Orientation="Horizontal" Padding="10" Spacing="10">

                                    <Label Text="{Binding NumeroCuota}" WidthRequest="60" VerticalTextAlignment="Center"/>
                                    <Label Text="{Binding FechaVto, StringFormat='{0:dd/MM/yyyy}'}" WidthRequest="100" VerticalTextAlignment="Center"/>
                                    <Label Text="{Binding FechaPago, Converter={StaticResource DateConverter}}" WidthRequest="100" VerticalTextAlignment="Center"/>
                                    <Label Text="{Binding MontoPagado, StringFormat='${0:N2}'}" WidthRequest="100" VerticalTextAlignment="Center"/>
                                    <Label Text="{Binding Estado}" WidthRequest="80" VerticalTextAlignment="Center"/>

                                    <!-- BotÃ³n borrar (se mantiene tu lÃ³gica y comando) -->
                                    <Button Text="ðŸ—‘"
                                BackgroundColor="Red"
                                TextColor="White"
                                WidthRequest="40"
                                HeightRequest="30"
                                HorizontalOptions="EndAndExpand"
                                Command="{Binding Source={x:Reference cuotasListView}, Path=BindingContext.BorrarCuotaCommand}"
                                CommandParameter="{Binding IdCuota}">
                                        <Button.Triggers>
                                            <DataTrigger TargetType="Button" Binding="{Binding Estado}" Value="PAGADA">
                                                <Setter Property="IsVisible" Value="True" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Button" Binding="{Binding Estado}" Value="Parcial">
                                                <Setter Property="IsVisible" Value="True" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Button" Binding="{Binding Estado}" Value="Impaga">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                        </Button.Triggers>
                                    </Button>

                                </StackLayout>
                            </Frame>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>




            <!-- BotÃ³n para compartir -->
            <Button Text="Compartir por WhatsApp"
                    Clicked="OnShareClicked"
                    BackgroundColor="Green"
                    TextColor="White"
                    FontAttributes="Bold"
                    Margin="0,20,0,0"/>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
